<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Voting MPK SMAN 23 Bandung</title>
    <link rel="icon" href="assets/logo nirbhadikara.PNG" type="image/png">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Green Theme Colors */
            --primary-50: #f0fdf4;
            --primary-100: #dcfce7;
            --primary-200: #bbf7d0;
            --primary-300: #86efac;
            --primary-400: #4ade80;
            --primary-500: #22c55e;
            --primary-600: #16a34a;
            --primary-700: #15803d;
            --primary-800: #166534;
            --primary-900: #14532d;
            
            /* Accent Colors */
            --emerald-500: #10b981;
            --emerald-600: #059669;
            --emerald-700: #047857;
            
            /* Neutral Colors */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Status Colors */
            --success-50: #f0fdf4;
            --success-500: #22c55e;
            --success-600: #16a34a;
            
            --warning-50: #fffbeb;
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            
            --error-50: #fef2f2;
            --error-500: #ef4444;
            --error-600: #dc2626;
            
            --info-50: #eff6ff;
            --info-500: #3b82f6;
            --info-600: #2563eb;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: var(--gray-50);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        .font-light { font-weight: 300; }
        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-extrabold { font-weight: 800; }
        
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-12 { margin-bottom: 3rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .py-12 { padding-top: 3rem; padding-bottom: 3rem; }
        .py-16 { padding-top: 4rem; padding-bottom: 4rem; }
        .py-20 { padding-top: 5rem; padding-bottom: 5rem; }

        /* Background Gradients */
        .bg-gradient-primary {
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--primary-100) 50%, var(--emerald-50) 100%);
            min-height: 100vh;
        }

        .bg-gradient-success {
            background: linear-gradient(135deg, var(--success-50) 0%, var(--primary-100) 100%);
            min-height: 100vh;
        }

        .bg-gradient-hero {
            background: linear-gradient(135deg, var(--primary-600) 0%, var(--emerald-600) 50%, var(--primary-700) 100%);
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 3.5rem;
            height: 3.5rem;
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.75rem;
            box-shadow: 0 4px 14px 0 rgba(34, 197, 94, 0.3);
        }

        .logo-text h1 {
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--gray-900);
            letter-spacing: -0.025em;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            color: white;
            box-shadow: 0 4px 14px 0 rgba(34, 197, 94, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(34, 197, 94, 0.4);
        }

        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--primary-300);
            transform: translateY(-1px);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-600), var(--emerald-600));
            color: white;
            box-shadow: 0 4px 14px 0 rgba(22, 163, 74, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px 0 rgba(22, 163, 74, 0.4);
        }

        .btn-lg {
            padding: 1.125rem 2.25rem;
            font-size: 1.125rem;
            border-radius: 1rem;
        }

        .btn:disabled {
            background: var(--gray-300);
            color: var(--gray-500);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 1.25rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--gray-100);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .card-header {
            padding: 2rem 1.5rem 1.5rem;
            border-bottom: 1px solid var(--gray-100);
            background: linear-gradient(135deg, var(--primary-50), white);
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.375rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .card-description {
            color: var(--gray-600);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Enhanced Grid */
        .grid {
            display: grid;
            gap: 2rem;
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--gray-700);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-200);
            border-radius: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            font-weight: 500;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
            transform: translateY(-1px);
        }

        .form-input.text-center {
            text-align: center;
            font-family: 'Inter', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: 0.1em;
        }

        /* Enhanced Alerts */
        .alert {
            padding: 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 500;
            border: 1px solid;
        }

        .alert-error {
            background: var(--error-50);
            border-color: #fecaca;
            color: var(--error-600);
        }

        .alert-success {
            background: var(--success-50);
            border-color: var(--primary-200);
            color: var(--success-600);
        }

        .alert-warning {
            background: var(--warning-50);
            border-color: #fed7aa;
            color: var(--warning-600);
        }

        .alert-info {
            background: var(--info-50);
            border-color: #bfdbfe;
            color: var(--info-600);
        }

        /* Enhanced Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-primary {
            background: linear-gradient(135deg, var(--primary-100), var(--primary-200));
            color: var(--primary-700);
            border: 1px solid var(--primary-300);
        }

        .badge-outline {
            background: white;
            border: 2px solid var(--gray-300);
            color: var(--gray-700);
        }

        /* Enhanced Candidate Cards */
        .candidate-card {
            border: 3px solid var(--gray-200);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .candidate-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--emerald-500));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .candidate-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-color: var(--primary-300);
        }

        .candidate-card:hover::before {
            transform: scaleX(1);
        }

        .candidate-card.selected {
            border-color: var(--primary-500);
            background: linear-gradient(135deg, var(--primary-50), white);
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1);
        }

        .candidate-card.selected::before {
            transform: scaleX(1);
        }

        .candidate-photo {
            width: 12rem;
            height: 14rem;
            object-fit: cover;
            border-radius: 1rem;
            border: 4px solid var(--gray-200);
            margin: 0 auto 1.5rem;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .candidate-card:hover .candidate-photo {
            border-color: var(--primary-300);
            transform: scale(1.02);
        }

        .candidate-card.selected .candidate-photo {
            border-color: var(--primary-500);
        }

        .candidate-number {
            position: absolute;
            top: -0.75rem;
            right: -0.75rem;
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 1rem;
            font-weight: 800;
            font-size: 1.75rem;
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
            border: 3px solid white;
        }

        /* Enhanced Tabs */
        .tabs {
            margin-top: 1.5rem;
        }

        .tab-list {
            display: flex;
            background: var(--gray-100);
            border-radius: 0.75rem;
            padding: 0.375rem;
            margin-bottom: 1.5rem;
        }

        .tab-button {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--gray-600);
        }

        .tab-button.active {
            background: white;
            color: var(--primary-700);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Enhanced Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: scale(0.9);
            animation: modalSlideIn 0.3s ease forwards;
        }

        @keyframes modalSlideIn {
            to {
                transform: scale(1);
            }
        }

        .modal-header {
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--gray-900);
        }

        .modal-footer {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* Enhanced Accordion */
        .accordion-item {
            border: 1px solid var(--gray-200);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .accordion-item:hover {
            border-color: var(--primary-300);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .accordion-trigger {
            width: 100%;
            padding: 1.25rem 1.5rem;
            background: white;
            border: none;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            color: var(--gray-800);
        }

        .accordion-trigger:hover {
            background: var(--primary-50);
            color: var(--primary-700);
        }

        .accordion-content {
            padding: 0 1.5rem 1.25rem;
            color: var(--gray-600);
            display: none;
            animation: slideDown 0.3s ease;
        }

        .accordion-content.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Enhanced Loading Spinner */
        .spinner {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--gray-200);
            border-top: 2px solid var(--primary-600);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 1.25rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            border: 1px solid var(--gray-100);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--emerald-500));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.75rem;
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Enhanced Hero Section */
        .hero {
            text-align: center;
            padding: 6rem 0;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="%2322c55e" stop-opacity="0.1"/><stop offset="100%" stop-color="%2322c55e" stop-opacity="0"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"/><circle cx="800" cy="300" r="150" fill="url(%23a)"/><circle cx="400" cy="700" r="120" fill="url(%23a)"/></svg>');
            pointer-events: none;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.1;
            color: var(--gray-900);
            position: relative;
        }

        .hero .subtitle {
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--gray-600);
            margin-bottom: 2.5rem;
            max-width: 48rem;
            margin-left: auto;
            margin-right: auto;
            font-weight: 500;
            line-height: 1.7;
        }

        /* Enhanced Footer */
        .footer {
            background: linear-gradient(135deg, var(--gray-900), var(--gray-800));
            color: white;
            text-align: center;
            padding: 3rem 0;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .footer-logo-icon {
            width: 2.5rem;
            height: 2.5rem;
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* Page Specific Styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .login-card {
            width: 100%;
            max-width: 36rem;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .login-icon {
            width: 6rem;
            height: 6rem;
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            color: white;
            font-size: 3rem;
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: var(--primary-600);
            text-decoration: none;
            margin-bottom: 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: var(--primary-700);
            transform: translateX(-4px);
        }

        .success-icon {
            width: 6rem;
            height: 6rem;
            background: linear-gradient(135deg, var(--success-600), var(--emerald-600));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 3rem;
            box-shadow: 0 8px 25px rgba(22, 163, 74, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .candidate-photo {
                width: 10rem;
                height: 12rem;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.125rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1.5rem 1rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .hero {
                padding: 4rem 0;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
        }

        /* Enhanced CTA Section */
        .cta-section {
            background: linear-gradient(135deg, var(--primary-600), var(--emerald-600));
            position: relative;
            overflow: hidden;
        }

        .cta-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="b" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="white" stop-opacity="0.1"/><stop offset="100%" stop-color="white" stop-opacity="0"/></radialGradient></defs><circle cx="100" cy="100" r="80" fill="url(%23b)"/><circle cx="900" cy="200" r="100" fill="url(%23b)"/><circle cx="300" cy="800" r="90" fill="url(%23b)"/></svg>');
            pointer-events: none;
        }

        /* Info Cards Enhancement */
        .info-card {
            position: relative;
            overflow: hidden;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-500), var(--emerald-500));
        }

        .info-card .card-header {
            background: linear-gradient(135deg, var(--primary-50), white);
        }

        /* Enhanced animations */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Floating elements */
        .floating {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div id="landing-page" class="page">
        <div class="bg-gradient-primary">
            <!-- Header -->
            <header class="header">
                <div class="container">
                    <div class="header-content">
                        <div class="logo">
                            <div class="logo-icon">
                                <img src="assets/logo nirbhadikara.PNG" style="width: 50px; height: 50px; border-radius: 0.75rem;">
                            </div>
                            <div class="logo-text">
                                <h1>Pemilu MPK 2025</h1>
                                <p>SMAN 23 Bandung</p>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-lg floating" onclick="navigateTo('login')">
                            🗳️ MASUK & VOTING
                        </button>
                    </div>
                </div>
            </header>

            <!-- Hero Section -->
            <section class="hero">
                <div class="container">
                    <div class="badge badge-primary mb-6">🗳️ PEMILU MPK PERIODE 2025-2026</div>
                    <h1>
                        Sistem Voting Digital<br>
                        <span class="subtitle">MPK SMAN 23 Bandung</span>
                    </h1>
                    <p>
                        Gunakan hak pilih Anda! Login dengan NISN dan NIPD untuk memilih calon Ketua MPK periode 2025-2026 dengan sistem voting digital yang aman dan terpercaya.
                    </p>
                    <button class="btn btn-primary btn-lg floating" onclick="navigateTo('login')" style="font-size: 1.25rem; padding: 1.25rem 2.5rem;">
                        🗳️ MULAI VOTING SEKARANG
                    </button>
                    <div class="alert alert-warning mt-8" style="max-width: 36rem; margin-left: auto; margin-right: auto;">
                        <strong>🛡️ PENTING:</strong> Setiap siswa hanya dapat voting SATU KALI. Pastikan pilihan Anda sudah tepat!
                    </div>
                </div>
            </section>

            <!-- Stats Section -->
            <section class="py-16">
                <div class="container">
                    <h2 class="text-center font-bold mb-12" style="font-size: 2.5rem; color: var(--gray-900);">Statistik Real-time</h2>
                    <div class="stats-grid" id="stats-section">
                        <div class="stat-card">
                            <div class="stat-number" id="total-votes">-</div>
                            <div class="stat-label">Total Suara</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="participation-rate">-</div>
                            <div class="stat-label">Tingkat Partisipasi</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Kandidat</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="remaining-students">-</div>
                            <div class="stat-label">Belum Voting</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Info Cards -->
            <section class="py-16">
                <div class="container">
                    <h2 class="text-center font-bold mb-12" style="font-size: 2.5rem; color: var(--gray-900);">Informasi Pemilu</h2>
                    <div class="grid grid-3">
                        <div class="card info-card">
                            <div class="card-header">
                                <div class="card-title" style="color: var(--primary-700);">📅 Jadwal Voting</div>
                            </div>
                            <div class="card-content">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding: 0.75rem; background: var(--success-50); border-radius: 0.5rem;">
                                    <span class="font-medium">Mulai:</span>
                                    <span class="font-bold" style="color: var(--success-600);">26 Januari 2025</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; padding: 0.75rem; background: var(--error-50); border-radius: 0.5rem;">
                                    <span class="font-medium">Berakhir:</span>
                                    <span class="font-bold" style="color: var(--error-600);">28 Januari 2025</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--info-50); border-radius: 0.5rem;">
                                    <span class="font-medium">Waktu:</span>
                                    <span class="font-semibold" style="color: var(--info-600);">08:00 - 15:00 WIB</span>
                                </div>
                            </div>
                        </div>
                        <div class="card info-card">
                            <div class="card-header">
                                <div class="card-title" style="color: var(--emerald-600);">👥 Kandidat</div>
                            </div>
                            <div class="card-content text-center">
                                <div style="font-size: 3rem; font-weight: 800; margin-bottom: 1rem; background: linear-gradient(135deg, var(--emerald-600), var(--primary-600)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">3</div>
                                <p class="font-semibold mb-2" style="font-size: 1.125rem;">Kandidat Terbaik</p>
                                <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1.5rem;">Calon Ketua MPK Periode 2025-2026</p>
                                <button class="btn btn-secondary" onclick="navigateTo('login')" style="width: 100%;">
                                    👁️ Lihat Kandidat
                                </button>
                            </div>
                        </div>
                        <div class="card info-card">
                            <div class="card-header">
                                <div class="card-title" style="color: var(--primary-600);">⚡ Cara Voting</div>
                            </div>
                            <div class="card-content">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem;">
                                    <span style="width: 2rem; height: 2rem; background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.875rem;">1</span>
                                    <span class="font-medium">Login dengan NISN & NIPD</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; font-size: 0.875rem;">
                                    <span style="width: 2rem; height: 2rem; background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.875rem;">2</span>
                                    <span class="font-medium">Pilih kandidat favorit Anda</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem; font-size: 0.875rem;">
                                    <span style="width: 2rem; height: 2rem; background: linear-gradient(135deg, var(--primary-500), var(--emerald-500)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.875rem;">3</span>
                                    <span class="font-medium">Submit pilihan final</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FAQ Section -->
            <section class="py-16" style="background: white;">
                <div class="container">
                    <div style="max-width: 64rem; margin: 0 auto;">
                        <div class="text-center mb-12">
                            <div style="font-size: 4rem; margin-bottom: 1.5rem;">❓</div>
                            <h2 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; color: var(--gray-900);">Frequently Asked Questions</h2>
                            <p style="color: var(--gray-600); font-size: 1.125rem; font-weight: 500;">Pertanyaan yang sering ditanyakan seputar pemilu MPK</p>
                        </div>
                        <div id="faq-accordion">
                            <div class="accordion-item">
                                <button class="accordion-trigger" onclick="toggleAccordion(0)">
                                    Bagaimana cara login ke sistem voting?
                                    <span>▼</span>
                                </button>
                                <div class="accordion-content">
                                    Anda perlu memasukkan NISN (Nomor Induk Siswa Nasional) dan NIPD (Nomor Induk Peserta Didik) yang sudah terdaftar di sistem sekolah. Pastikan data yang dimasukkan benar dan sesuai dengan data di administrasi sekolah.
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-trigger" onclick="toggleAccordion(1)">
                                    Apakah saya bisa mengubah pilihan setelah voting?
                                    <span>▼</span>
                                </button>
                                <div class="accordion-content">
                                    Tidak. Setelah Anda submit pilihan, suara tidak dapat diubah lagi. Pastikan pilihan Anda sudah benar sebelum menekan tombol submit. Sistem akan memberikan konfirmasi sebelum pilihan final disimpan.
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-trigger" onclick="toggleAccordion(2)">
                                    Berapa kali saya bisa voting?
                                    <span>▼</span>
                                </button>
                                <div class="accordion-content">
                                    Setiap siswa hanya dapat melakukan voting SATU KALI saja. Setelah voting, Anda tidak akan bisa login lagi ke sistem untuk voting ulang. Ini untuk menjaga integritas dan keadilan pemilu.
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-trigger" onclick="toggleAccordion(3)">
                                    Kapan hasil pemilu akan diumumkan?
                                    <span>▼</span>
                                </button>
                                <div class="accordion-content">
                                    Hasil pemilu akan diumumkan secara resmi oleh panitia pemilu setelah masa voting berakhir dan proses verifikasi selesai. Pengumuman akan dilakukan melalui pengeras suara sekolah dan papan pengumuman.
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-trigger" onclick="toggleAccordion(4)">
                                    Bagaimana jika saya lupa NISN atau NIPD?
                                    <span>▼</span>
                                </button>
                                <div class="accordion-content">
                                    Jika Anda lupa NISN atau NIPD, silakan hubungi wali kelas atau bagian tata usaha sekolah. Mereka akan membantu Anda mendapatkan informasi yang diperlukan untuk login ke sistem voting.
                                </div>
                            </div>
                            <div class="accordion-item">
                                <button class="accordion-trigger" onclick="toggleAccordion(5)">
                                    Apakah voting ini aman dan rahasia?
                                    <span>▼</span>
                                </button>
                                <div class="accordion-content">
                                    Ya, sistem voting ini menggunakan teknologi yang aman. Pilihan Anda bersifat rahasia dan tidak dapat dilihat oleh siapapun. Hanya hasil akhir yang akan diumumkan tanpa mengungkap siapa memilih kandidat mana.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CTA Section -->
            <section class="py-16 cta-section">
                <div class="container text-center">
                    <h2 style="font-size: 2.5rem; font-weight: 800; color: white; margin-bottom: 1rem;">Siap untuk Voting?</h2>
                    <p style="color: rgba(255,255,255,0.9); margin-bottom: 2.5rem; font-size: 1.25rem; font-weight: 500;">Jangan sampai terlewat! Gunakan hak pilih Anda sekarang juga.</p>
                    <button class="btn btn-lg floating" style="background: white; color: var(--primary-600); font-weight: 700; font-size: 1.25rem; padding: 1.25rem 2.5rem;" onclick="navigateTo('login')">
                        🗳️ VOTING SEKARANG
                    </button>
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <div class="container">
                    <div class="footer-logo">
                        <div class="footer-logo-icon">
                            <img src="assets/logo nirbhadikara.PNG" style="width: 35px; height: 35px; border-radius: 0.5rem;">
                        </div>
                        <span style="font-size: 1.375rem; font-weight: 700;">Pemilu MPK 2025</span>
                    </div>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 0.75rem; font-weight: 500;">© 2025 SMAN 23 Bandung. Sistem Pemilu MPK Digital.</p>
                    <p style="font-size: 0.875rem; color: rgba(255,255,255,0.7);">Untuk bantuan teknis, hubungi panitia pemilu MPK.</p>
                    <p style="font-size: 0.875rem; color: rgba(255,255,255,0.7); margin-top: 0.5rem;">Made with 💚 by angkatan 3, for angkatan 4 MPK</p>
                </div>
            </footer>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page hidden">
        <div class="bg-gradient-primary login-container">
            <div class="login-card">
                <div class="login-header">
                    <a href="#" class="back-link" onclick="navigateTo('landing')">
                        ← Kembali ke Beranda
                    </a>
                    <div class="login-icon">🗳️</div>
                    <h1 style="font-size: 2.25rem; font-weight: 800; margin-bottom: 0.75rem; color: var(--gray-900);">Login E-Voting</h1>
                    <p style="color: var(--gray-600); font-size: 1.125rem; font-weight: 500;">MPK SMAN 23 Bandung Periode 2025-2026</p>
                </div>
                <div class="card">
                    <div class="card-header text-center">
                        <div class="card-title" style="color: var(--primary-700);">Masuk untuk Memilih</div>
                        <div class="card-description" style="font-size: 1rem;">Gunakan NISN dan NIPD yang terdaftar di sekolah</div>
                    </div>
                    <div class="card-content">
                        <form id="login-form">
                            <div class="form-group">
                                <label class="form-label">NISN (Nomor Induk Siswa Nasional)</label>
                                <input type="text" id="nisn" class="form-input text-center" placeholder="Contoh: 1234567890" maxlength="10" required>
                                <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.5rem; font-weight: 500;">10 digit angka</p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">NIPD (Nomor Induk Peserta Didik)</label>
                                <input type="text" id="nipd" class="form-input text-center" placeholder="Contoh: 123456" maxlength="12" required>
                                <p style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.5rem; font-weight: 500;">Minimal 6 digit angka</p>
                            </div>
                            <div id="login-error" class="alert alert-error hidden"></div>
                            <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="login-btn">
                                🗳️ MASUK & MULAI VOTING
                            </button>
                        </form>
                        <div class="alert alert-info mt-6">
                            <strong>💡 Demo Login:</strong><br>
                            <strong>NISN:</strong> 1234567890<br>
                            <strong>NIPD:</strong> 123456
                        </div>
                        <div class="alert alert-warning mt-4">
                            <strong>🛡️ Penting!</strong><br>
                            Setiap siswa hanya dapat voting SATU KALI. Pastikan pilihan Anda sudah tepat sebelum submit.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voting Page -->
    <div id="voting-page" class="page hidden">
        <div class="bg-gradient-primary">
            <!-- Header -->
            <header class="header">
                <div class="container">
                    <div class="header-content">
                        <div class="logo">
                            <div class="logo-icon">🗳️</div>
                            <div class="logo-text">
                                <h1>E-Voting MPK 2025-2026</h1>
                                <p id="student-info">NISN: - | NIPD: -</p>
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="logout()">
                            ← Keluar
                        </button>
                    </div>
                </div>
            </header>
            <div class="container py-8">
                <!-- Header Section -->
                <div class="text-center mb-12">
                    <div class="badge badge-primary mb-6" style="font-size: 1.25rem; padding: 1rem 2rem;">
                        👥 PEMILIHAN KETUA MPK
                    </div>
                    <h2 style="font-size: 2.75rem; font-weight: 800; margin-bottom: 1.5rem; color: var(--gray-900);">Pilih Kandidat Ketua MPK</h2>
                    <p style="color: var(--gray-600); font-size: 1.25rem; margin-bottom: 2rem; font-weight: 500; line-height: 1.7;">
                        Pilih SATU kandidat yang menurut Anda paling tepat memimpin MPK SMAN 23 Bandung periode 2025-2026
                    </p>
                    <div class="alert alert-error" style="max-width: 36rem; margin: 0 auto;">
                        <strong>⚠️ PERHATIAN:</strong> Pilihan tidak dapat diubah setelah submit. Pastikan pilihan Anda sudah tepat!
                    </div>
                </div>

                <!-- Candidates Grid -->
                <div class="grid grid-3 mb-12" id="candidates-grid">
                    <!-- Candidates will be populated by JavaScript -->
                </div>

                <!-- Submit Section -->
                <div class="card" style="border: 3px solid var(--primary-200); background: linear-gradient(135deg, var(--primary-50), white);">
                    <div class="card-content text-center" style="padding: 2.5rem;">
                        <h3 style="font-size: 1.75rem; font-weight: 800; margin-bottom: 1.5rem; color: var(--gray-900);">Konfirmasi Pilihan Anda</h3>
                        <div id="selected-candidate-info" class="mb-8">
                            <div class="alert alert-warning">
                                <p class="font-medium">Belum ada kandidat yang dipilih</p>
                            </div>
                        </div>
                        <button id="submit-vote-btn" class="btn btn-primary btn-lg" style="padding: 1.25rem 3rem; font-size: 1.375rem; font-weight: 700;" disabled>
                            🗳️ SUBMIT PILIHAN SAYA
                        </button>
                        <p id="submit-help-text" style="font-size: 0.875rem; color: var(--gray-500); margin-top: 1rem; font-weight: 500;">
                            Pilih salah satu kandidat terlebih dahulu
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Page -->
    <div id="success-page" class="page hidden">
        <div class="bg-gradient-success login-container">
            <div class="card" style="max-width: 32rem; margin: 0 auto;">
                <div class="card-header text-center">
                    <div class="success-icon">✓</div>
                    <div class="card-title" style="color: var(--success-600); font-size: 1.75rem; font-weight: 800;">Voting Berhasil!</div>
                    <div class="card-description" style="font-size: 1.25rem; font-weight: 500;">Terima kasih telah menggunakan hak pilih Anda</div>
                </div>
                <div class="card-content">
                    <div class="alert alert-success mb-8" id="success-info">
                        <!-- Success info will be populated by JavaScript -->
                    </div>
                    <div class="alert alert-info mb-8">
                        <h3 class="font-semibold mb-3" style="color: var(--info-600);">Informasi Penting:</h3>
                        <ul style="font-size: 0.875rem; padding-left: 1.5rem; line-height: 1.6;">
                            <li>• Suara Anda telah tercatat dengan aman di database</li>
                            <li>• Hasil akan diumumkan setelah pemilu berakhir</li>
                            <li>• Anda tidak dapat mengubah pilihan</li>
                        </ul>
                    </div>
                    <button class="btn btn-secondary btn-lg" style="width: 100%;" onclick="logout()">
                        ← Keluar dari Sistem
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">⚠️ Konfirmasi Pilihan</div>
                <p style="color: var(--gray-600); font-weight: 500;">Apakah Anda yakin dengan pilihan ini? Pilihan tidak dapat diubah setelah submit.</p>
            </div>
            <div id="modal-candidate-info" class="alert alert-info mb-6">
                <!-- Candidate info will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Batal</button>
                <button class="btn btn-primary" id="confirm-vote-btn">
                    ✓ Ya, Submit
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBR_9ryRd7elw8I7QRgQnMdXip992i0exo",
            authDomain: "pemilulagi.firebaseapp.com",
            databaseURL: "https://pemilulagi-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pemilulagi",
            storageBucket: "pemilulagi.firebasestorage.app",
            messagingSenderId: "7935828527",
            appId: "1:7935828527:web:829c422bf7fa50dd289cda"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let candidates = []; // Will be loaded from Firebase
        let currentPage = 'landing';
        let selectedCandidate = null;
        let studentData = null;
        let totalStudents = 1100; // Default, will be updated from Firebase
        let realTimeListeners = [];

        // Load candidates from Firebase
        async function loadCandidatesFromFirebase() {
            try {
                const candidatesRef = database.ref('candidates');
                const snapshot = await candidatesRef.once('value');
                const candidatesData = snapshot.val();
                
                if (candidatesData) {
                    // Convert Firebase object to array format
                    candidates = Object.keys(candidatesData).map(key => ({
                        id: key,
                        nomor: candidatesData[key].nomor || key.padStart(2, '0'),
                        nama: candidatesData[key].nama || 'Nama Kandidat',
                        kelas: candidatesData[key].kelas || 'Kelas',
                        visi: candidatesData[key].visi || 'Visi kandidat',
                        misi: candidatesData[key].misi || [],
                        program: candidatesData[key].program || [],
                        votes: candidatesData[key].votes || 0
                    }));
                    
                    console.log('✅ Candidates loaded from Firebase:', candidates.length, 'candidates');
                } else {
                    console.log('⚠️ No candidates found in Firebase');
                    candidates = [];
                }
            } catch (error) {
                console.error('❌ Error loading candidates from Firebase:', error);
                candidates = [];
            }
        }

        // Load settings from Firebase
        async function loadSettingsFromFirebase() {
            try {
                const settingsRef = database.ref('settings');
                const snapshot = await settingsRef.once('value');
                const settings = snapshot.val();
                
                if (settings) {
                    totalStudents = settings.totalStudents || 1100;
                    console.log('✅ Settings loaded from Firebase. Total students:', totalStudents);
                }
            } catch (error) {
                console.error('❌ Error loading settings from Firebase:', error);
            }
        }

        // Load real-time statistics with enhanced error handling
        function loadStatistics() {
            // Clear existing listeners
            realTimeListeners.forEach(listener => {
                if (listener && typeof listener.off === 'function') {
                    listener.off();
                }
            });
            realTimeListeners = [];

            try {
                // Listen to votes changes
                const votesListener = database.ref('votes').on('value', (snapshot) => {
                    try {
                        const votesData = snapshot.val() || {};
                        let totalVotes = 0;
                        
                        // Count total votes dari semua tanggal
                        for (const date in votesData) {
                            if (votesData[date] && typeof votesData[date] === 'object') {
                                totalVotes += Object.keys(votesData[date]).length;
                            }
                        }
                        
                        const participationRate = totalStudents > 0 ? ((totalVotes / totalStudents) * 100).toFixed(1) : '0.0';
                        const remainingStudents = Math.max(0, totalStudents - totalVotes);

                        // Update UI with smooth animation
                        updateStatWithAnimation('total-votes', totalVotes.toLocaleString('id-ID'));
                        updateStatWithAnimation('participation-rate', participationRate + '%');
                        updateStatWithAnimation('remaining-students', remainingStudents.toLocaleString('id-ID'));

                        console.log(`📊 Stats updated: ${totalVotes} votes, ${participationRate}% participation`);
                    } catch (error) {
                        console.error('❌ Error processing votes data:', error);
                    }
                }, (error) => {
                    console.error('❌ Error listening to votes:', error);
                });

                // Listen to settings changes
                const settingsListener = database.ref('settings').on('value', (snapshot) => {
                    try {
                        const settings = snapshot.val();
                        if (settings && settings.totalStudents) {
                            totalStudents = settings.totalStudents;
                        }
                    } catch (error) {
                        console.error('❌ Error processing settings data:', error);
                    }
                }, (error) => {
                    console.error('❌ Error listening to settings:', error);
                });

                // Listen to candidates changes (for real-time vote count updates)
                const candidatesListener = database.ref('candidates').on('value', (snapshot) => {
                    try {
                        const candidatesData = snapshot.val();
                        if (candidatesData) {
                            // Update candidates array with latest vote counts
                            candidates.forEach(candidate => {
                                if (candidatesData[candidate.id]) {
                                    candidate.votes = candidatesData[candidate.id].votes || 0;
                                }
                            });
                        }
                    } catch (error) {
                        console.error('❌ Error processing candidates data:', error);
                    }
                }, (error) => {
                    console.error('❌ Error listening to candidates:', error);
                });

                realTimeListeners.push(votesListener, settingsListener, candidatesListener);
            } catch (error) {
                console.error('❌ Error setting up real-time listeners:', error);
            }
        }

        // Update stat with smooth animation
        function updateStatWithAnimation(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== newValue) {
                element.style.transform = 'scale(1.1)';
                element.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                element.textContent = newValue;
                
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 400);
            }
        }

        // Check if student has already voted
        async function checkIfVoted(nisn) {
            try {
                const votesRef = database.ref('votes');
                const snapshot = await votesRef.once('value');
                const votesData = snapshot.val() || {};
                
                for (const date in votesData) {
                    if (votesData[date] && votesData[date][nisn]) {
                        return true;
                    }
                }
                return false;
            } catch (error) {
                console.error('❌ Error checking vote status:', error);
                return false;
            }
        }

        // Save vote to Firebase
        async function saveVote(nisn, nipd, candidateId, retryCount = 0) {
            const maxRetries = 3;
            
            try {
                const now = new Date();
                const date = now.toISOString().split('T')[0]; // YYYY-MM-DD
                const time = now.toTimeString().split(' ')[0]; // HH:MM:SS
                
                // Double-check if already voted
                const hasVoted = await checkIfVoted(nisn);
                if (hasVoted) {
                    throw new Error('Student has already voted');
                }
                
                // Save vote record
                await database.ref(`votes/${date}/${nisn}`).set({
                    nisn: nisn,
                    nipd: nipd,
                    candidateId: candidateId,
                    time: time,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    userAgent: navigator.userAgent.substring(0, 100),
                    ip: await getClientIP().catch(() => 'unknown')
                });

                // Update candidate vote count using transaction
                const candidateRef = database.ref(`candidates/${candidateId}/votes`);
                await candidateRef.transaction((currentVotes) => {
                    return (currentVotes || 0) + 1;
                });

                console.log('✅ Vote saved successfully');
                return true;
            } catch (error) {
                console.error(`❌ Error saving vote (attempt ${retryCount + 1}):`, error);
                
                if (retryCount < maxRetries) {
                    console.log(`🔄 Retrying vote save... (${retryCount + 1}/${maxRetries})`);
                    await new Promise(resolve => setTimeout(resolve, 1000 * (retryCount + 1)));
                    return saveVote(nisn, nipd, candidateId, retryCount + 1);
                }
                
                return false;
            }
        }

        // Get client IP
        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }

        // Navigation
        function navigateTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(page + '-page').classList.remove('hidden');
            currentPage = page;

            if (page === 'voting') {
                checkLoginStatus();
                renderCandidates();
                updateStudentInfo();
            } else if (page === 'landing') {
                loadStatistics();
            }
        }

        // Login functionality
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const nisn = document.getElementById('nisn').value.trim();
            const nipd = document.getElementById('nipd').value.trim();
            const errorDiv = document.getElementById('login-error');
            const loginBtn = document.getElementById('login-btn');

            errorDiv.classList.add('hidden');

            if (!nisn || nisn.length !== 10 || !/^\d+$/.test(nisn)) {
                showError('NISN harus berupa 10 digit angka');
                return;
            }
            if (!nipd || nipd.length < 6 || !/^\d+$/.test(nipd)) {
                showError('NIPD harus berupa minimal 6 digit angka');
                return;
            }

            loginBtn.innerHTML = '<div class="spinner"></div>Memverifikasi...';
            loginBtn.disabled = true;

            try {
                const hasVoted = await checkIfVoted(nisn);
                if (hasVoted) {
                    showError('Anda sudah melakukan voting sebelumnya. Setiap siswa hanya dapat voting satu kali.');
                    resetLoginButton();
                    return;
                }

                await new Promise(resolve => setTimeout(resolve, 1500));

                studentData = { nisn, nipd };
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('studentNISN', nisn);
                localStorage.setItem('studentNIPD', nipd);

                navigateTo('voting');
            } catch (error) {
                console.error('❌ Login error:', error);
                showError('Terjadi kesalahan sistem. Silakan coba lagi.');
                resetLoginButton();
            }

            function showError(message) {
                errorDiv.textContent = message;
                errorDiv.classList.remove('hidden');
            }

            function resetLoginButton() {
                loginBtn.innerHTML = '🗳️ MASUK & MULAI VOTING';
                loginBtn.disabled = false;
            }
        });

        // Input formatting
        document.getElementById('nisn').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').slice(0, 10);
        });

        document.getElementById('nipd').addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '').slice(0, 12);
        });

        // Check login status
        async function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const nisn = localStorage.getItem('studentNISN');
            const nipd = localStorage.getItem('studentNIPD');

            if (!isLoggedIn || !nisn) {
                navigateTo('login');
                return false;
            }

            try {
                const hasVoted = await checkIfVoted(nisn);
                if (hasVoted) {
                    showSuccessPage();
                    return false;
                }
                studentData = { nisn, nipd };
                return true;
            } catch (error) {
                console.error('❌ Error checking login status:', error);
                navigateTo('login');
                return false;
            }
        }

        // Update student info
        function updateStudentInfo() {
            if (studentData) {
                document.getElementById('student-info').textContent = 
                    `NISN: ${studentData.nisn} | NIPD: ${studentData.nipd}`;
            }
        }

        // Render candidates
        function renderCandidates() {
            const grid = document.getElementById('candidates-grid');
            grid.innerHTML = '';

            if (candidates.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <div class="spinner" style="margin: 0 auto 1rem;"></div>
                        <p style="color: var(--gray-600); font-size: 1.125rem; font-weight: 500;">Memuat data kandidat...</p>
                    </div>
                `;
                return;
            }

            candidates.forEach(candidate => {
                const candidateDiv = document.createElement('div');
                candidateDiv.innerHTML = `
                    <div class="candidate-card card" data-candidate-id="${candidate.id}">
                        <div class="card-header text-center" style="position: relative; padding-bottom: 1.5rem;">
                            <img src="assets/${candidate.nama}.jpg"
                                 alt="${candidate.nama}" class="candidate-photo">
                            <div class="candidate-number">${candidate.nomor}</div>
                            <div class="card-title" style="font-size: 1.5rem; color: var(--gray-900);">${candidate.nama}</div>
                            <div class="card-description" style="font-size: 1.125rem; color: var(--primary-600); font-weight: 600;">${candidate.kelas}</div>
                        </div>
                        <div class="card-content" style="padding-top: 0;">
                            <button class="candidate-select-btn btn btn-secondary" style="width: 100%; padding: 1rem; font-size: 1.125rem; font-weight: 600;" onclick="selectCandidate('${candidate.id}')">
                                👤 PILIH KANDIDAT
                            </button>
                        </div>
                    </div>
                    <div class="card mt-6">
                        <div class="card-header">
                            <div class="card-title" style="color: var(--primary-700);">👁️ Detail Kandidat ${candidate.nomor}</div>
                        </div>
                        <div class="card-content">
                            <div class="tabs">
                                <div class="tab-list">
                                    <button class="tab-button active" onclick="switchTab(this, 'visi-${candidate.id}')">🎯 Visi</button>
                                    <button class="tab-button" onclick="switchTab(this, 'misi-${candidate.id}')">💡 Misi</button>
                                    <button class="tab-button" onclick="switchTab(this, 'program-${candidate.id}')">🗳️ Jargon</button>
                                </div>
                                <div id="visi-${candidate.id}" class="tab-content active">
                                    <h4 class="font-semibold mb-3" style="color: var(--primary-600); font-size: 1.125rem;">🎯 Visi</h4>
                                    <p style="font-size: 0.875rem; color: var(--gray-700); line-height: 1.7; background: var(--primary-50); padding: 1rem; border-radius: 0.75rem; border: 1px solid var(--primary-200);">
                                        ${candidate.visi}
                                    </p>
                                </div>
                                <div id="misi-${candidate.id}" class="tab-content">
                                    <h4 class="font-semibold mb-3" style="color: var(--emerald-600); font-size: 1.125rem;">💡 Misi</h4>
                                    <ul style="list-style: none; padding: 0;">
                                        ${Array.isArray(candidate.misi) ? candidate.misi.map((misi, index) => `
                                            <li style="font-size: 0.875rem; color: var(--gray-700); display: flex; align-items: flex-start; background: var(--success-50); padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--primary-200); margin-bottom: 0.75rem;">
                                                <span style="width: 1.5rem; height: 1.5rem; background: linear-gradient(135deg, var(--emerald-600), var(--primary-600)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; margin-right: 0.75rem; margin-top: 0.125rem; flex-shrink: 0;">
                                                    ${index + 1}
                                                </span>
                                                <span style="line-height: 1.6;">${misi}</span>
                                            </li>
                                        `).join('') : '<p style="color: var(--gray-500); font-style: italic;">Misi belum tersedia</p>'}
                                    </ul>
                                </div>
                                <div id="program-${candidate.id}" class="tab-content">
                                    <h4 class="font-semibold mb-3" style="color: var(--primary-600); font-size: 1.125rem;">🗳️ Jargon</h4>
                                    <p style="font-size: 0.875rem; color: var(--gray-700); line-height: 1.7; background: var(--primary-50); padding: 1rem; border-radius: 0.75rem; border: 1px solid var(--primary-200);">
                                        ${candidate.program}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(candidateDiv);
            });
        }

        // Select candidate
        function selectCandidate(candidateId) {
            selectedCandidate = candidateId;
    
            document.querySelectorAll('.candidate-card').forEach(card => {
                card.classList.remove('selected');
            });
    
            document.querySelectorAll('.candidate-select-btn').forEach(btn => {
                btn.innerHTML = '👤 PILIH KANDIDAT';
                btn.className = 'candidate-select-btn btn btn-secondary';
            });

            const selectedCard = document.querySelector(`[data-candidate-id="${candidateId}"]`);
            const selectedBtn = selectedCard.querySelector('.candidate-select-btn');
    
            selectedCard.classList.add('selected');
            selectedBtn.innerHTML = '✓ TERPILIH';
            selectedBtn.className = 'candidate-select-btn btn btn-primary';

            updateConfirmationSection();
        }

        // Update confirmation section
        function updateConfirmationSection() {
            const infoDiv = document.getElementById('selected-candidate-info');
            const submitBtn = document.getElementById('submit-vote-btn');
            const helpText = document.getElementById('submit-help-text');

            if (selectedCandidate) {
                const candidate = candidates.find(c => c.id === selectedCandidate);
                if (candidate) {
                    infoDiv.innerHTML = `
                        <div class="alert alert-info">
                            <p class="font-semibold mb-3" style="color: var(--info-600); font-size: 1.125rem;">Kandidat Terpilih:</p>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 1.5rem;">
                                <div class="badge badge-outline" style="font-size: 1.5rem; font-weight: bold; padding: 0.75rem 1rem;">
                                    ${candidate.nomor}
                                </div>
                                <div>
                                    <p style="font-size: 1.375rem; font-weight: 700; color: var(--info-600);">
                                        ${candidate.nama}
                                    </p>
                                    <p style="color: var(--primary-600); margin-top: 0.25rem; font-weight: 600;">${candidate.kelas}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    submitBtn.disabled = false;
                    submitBtn.style.background = 'linear-gradient(135deg, var(--primary-600), var(--emerald-600))';
                    submitBtn.style.cursor = 'pointer';
                    helpText.style.display = 'none';
                }
            } else {
                infoDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <p class="font-medium">Belum ada kandidat yang dipilih</p>
                    </div>
                `;
                submitBtn.disabled = true;
                submitBtn.style.background = 'var(--gray-300)';
                submitBtn.style.cursor = 'not-allowed';
                helpText.style.display = 'block';
            }
        }

        // Submit vote
        document.getElementById('submit-vote-btn').addEventListener('click', function() {
            if (!selectedCandidate) return;
    
            const modal = document.getElementById('confirmation-modal');
            const candidate = candidates.find(c => c.id === selectedCandidate);
    
            if (candidate) {
                document.getElementById('modal-candidate-info').innerHTML = `
                    <p class="font-semibold mb-3" style="color: var(--info-600);">Pilihan Anda:</p>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="badge badge-outline" style="font-size: 1.25rem; font-weight: bold;">
                            ${candidate.nomor}
                        </div>
                        <div>
                            <p class="font-bold" style="color: var(--info-600); font-size: 1.125rem;">${candidate.nama}</p>
                            <p style="font-size: 0.875rem; color: var(--primary-600); font-weight: 600;">${candidate.kelas}</p>
                        </div>
                    </div>
                `;
        
                modal.classList.remove('hidden');
            }
        });

        // Confirm vote
        document.getElementById('confirm-vote-btn').addEventListener('click', async function() {
            const btn = this;
            btn.innerHTML = '<div class="spinner"></div>Menyimpan ke Database...';
            btn.disabled = true;

            try {
                const success = await saveVote(studentData.nisn, studentData.nipd, selectedCandidate);
        
                if (success) {
                    localStorage.setItem('selectedCandidate', selectedCandidate);
                    closeModal();
                    showSuccessPage();
                } else {
                    throw new Error('Failed to save vote');
                }
            } catch (error) {
                console.error('❌ Error submitting vote:', error);
                alert('Terjadi kesalahan saat menyimpan suara. Silakan coba lagi.');
                btn.innerHTML = '✓ Ya, Submit';
                btn.disabled = false;
            }
        });

        // Show success page
        function showSuccessPage() {
            const candidate = candidates.find(c => c.id === selectedCandidate);
    
            document.getElementById('success-info').innerHTML = `
                <strong>NISN:</strong> ${studentData.nisn}<br>
                <strong>Status:</strong> Sudah Voting ✓<br>
                <strong>Waktu:</strong> ${new Date().toLocaleString('id-ID')}<br>
                ${candidate ? `<strong>Pilihan:</strong> ${candidate.nomor} - ${candidate.nama}` : ''}
            `;
    
            navigateTo('success');
        }

        // Modal functions
        function closeModal() {
            document.getElementById('confirmation-modal').classList.add('hidden');
            document.getElementById('confirm-vote-btn').innerHTML = '✓ Ya, Submit';
            document.getElementById('confirm-vote-btn').disabled = false;
        }

        // Tab switching
        function switchTab(button, tabId) {
            const tabList = button.parentElement;
            tabList.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            const tabsContainer = tabList.parentElement;
            tabsContainer.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            document.getElementById(tabId).classList.add('active');
        }

        // Accordion functionality
        function toggleAccordion(index) {
            const items = document.querySelectorAll('.accordion-item');
            const content = items[index].querySelector('.accordion-content');
            const trigger = items[index].querySelector('.accordion-trigger span');
    
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                trigger.textContent = '▼';
            } else {
                items.forEach((item, i) => {
                    if (i !== index) {
                        item.querySelector('.accordion-content').classList.remove('active');
                        item.querySelector('.accordion-trigger span').textContent = '▼';
                    }
                });
        
                content.classList.add('active');
                trigger.textContent = '▲';
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('studentNISN');
            localStorage.removeItem('studentNIPD');
            localStorage.removeItem('selectedCandidate');
    
            realTimeListeners.forEach(listener => {
                if (listener && typeof listener.off === 'function') {
                    listener.off();
                }
            });
            realTimeListeners = [];
    
            selectedCandidate = null;
            studentData = null;
    
            navigateTo('landing');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('🚀 Initializing E-Voting System...');
    
            try {
                // Load data from Firebase
                await loadCandidatesFromFirebase();
                await loadSettingsFromFirebase();
        
                // Load statistics
                loadStatistics();

                // Check login status
                const isLoggedIn = localStorage.getItem('isLoggedIn');
                const nisn = localStorage.getItem('studentNISN');
                const nipd = localStorage.getItem('studentNIPD');

                if (isLoggedIn && nisn) {
                    studentData = { nisn, nipd };
            
                    try {
                        const hasVoted = await checkIfVoted(nisn);
                        if (hasVoted) {
                            selectedCandidate = localStorage.getItem('selectedCandidate');
                            showSuccessPage();
                        } else {
                            navigateTo('voting');
                        }
                    } catch (error) {
                        console.error('❌ Error checking vote status:', error);
                        navigateTo('landing');
                    }
                } else {
                    navigateTo('landing');
                }

                console.log('✅ E-Voting System initialized successfully');
            } catch (error) {
                console.error('❌ Error initializing app:', error);
                navigateTo('landing');
            }
        });

        // Close modal when clicking outside
        document.getElementById('confirmation-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Connection monitoring
        let connectionCheckInterval;

        function startConnectionMonitoring() {
            connectionCheckInterval = setInterval(() => {
                if (currentPage === 'landing') {
                    database.ref('.info/connected').once('value', (snapshot) => {
                        if (snapshot.val() === true) {
                            console.log('🔗 Firebase connection active');
                        } else {
                            console.log('⚠️ Firebase connection lost, attempting to reconnect...');
                        }
                    });
                }
            }, 30000);
        }

        startConnectionMonitoring();

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (connectionCheckInterval) {
                clearInterval(connectionCheckInterval);
            }
    
            realTimeListeners.forEach(listener => {
                if (listener && typeof listener.off === 'function') {
                    listener.off();
                }
            });
        });

        // Enhanced error handling for Firebase operations
        database.ref('.info/connected').on('value', (snapshot) => {
            if (snapshot.val() === true) {
                console.log('🔥 Connected to Firebase');
            } else {
                console.log('❌ Disconnected from Firebase');
            }
        });

        console.log('📱 E-Voting System script loaded successfully');
    </script>
</body>
</html>